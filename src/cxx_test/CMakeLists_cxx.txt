# ###############################################################################
cmake_minimum_required(VERSION 3.8 FATAL_ERROR)
set(CMAKE_CUDA_ARCHITECTURES 61 75)
project(CXX_TEST LANGUAGES CXX)

# ###############################################################################
set(EXTERNAL_DIR "${CMAKE_CURRENT_SOURCE_DIR}/extern")
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/lib")
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/lib")
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/bin")
set(CMAKE_DEBUG_POSTFIX "d")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fPIC")
set(CMAKE_CXX_STANDARD 17)

# ###############################################################################
find_package(OpenMP)

if(OPENMP_FOUND)
    set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} ${OpenMP_C_FLAGS}")
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${OpenMP_CXX_FLAGS}")
    set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} ${OpenMP_EXE_LINKER_FLAGS}")
endif()

# add dependencies
list(APPEND CMAKE_MODULE_PATH ${CMAKE_CURRENT_SOURCE_DIR}/cmake)
option(AUTO_DOWNLOAD "Auto download dependencies" ON)

# include(LibiglOptions) # must enable before rpdDependencies
include(rpdDependencies)

add_subdirectory(extern/mshloader)

# ###############################################################################
# For VolumeVoronoiGPU binary
# ###############################################################################
set(CXX_SOURCE_LIST
    "src/cxx_test/main_gui_cxx.cxx"
    "src/cxx_test/main_voronoi.cxx"
    "src/io.cxx"
    "src/medial_sphere.cxx"
    "src/shrinking.cxx"
    "src/updating.cxx"
    "src/external/Predicates.cxx"
)

add_executable(${PROJECT_NAME} ${CXX_SOURCE_LIST})
target_compile_definitions(${PROJECT_NAME} PUBLIC -Dgeogram_EXPORTS)

if(${MSVC})
    if(${CMAKE_VERSION} VERSION_GREATER 3.6.0)
        set_property(DIRECTORY PROPERTY VS_STARTUP_PROJECT "${PROJECT_NAME}")
    endif()
endif()

target_link_directories(${PROJECT_NAME} PUBLIC "${CMAKE_BINARY_DIR}/lib")
target_link_libraries(${PROJECT_NAME}
    optimized mshloader
    optimized polyscope
    optimized geogram

    # optimized igl::core
    # optimized igl::predicates
)

# ###############################################################################
# For VORO_GUI binary
# ###############################################################################
set(CMAKE_CXX_STANDARD 14)
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++14 -Wall -pthread -D_DEBUG")

add_executable(VORO_GUI src/test_gui.cpp)
target_link_libraries(VORO_GUI PUBLIC polyscope mshloader)